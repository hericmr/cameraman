var S=Object.defineProperty;var V=(n,s,a)=>s in n?S(n,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[s]=a;var A=(n,s,a)=>V(n,typeof s!="symbol"?s+"":s,a);(function(){"use strict";let n;const s=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&s.decode();let a=null;function y(){return(a===null||a.byteLength===0)&&(a=new Uint8Array(n.memory.buffer)),a}function g(e,t){return e=e>>>0,s.decode(y().subarray(e,e+t))}const c=new Array(128).fill(void 0);c.push(void 0,null,!0,!1);let l=c.length;function M(e){l===c.length&&c.push(c.length+1);const t=l;return l=c[t],c[t]=e,t}let f=null;function u(){return(f===null||f.buffer.detached===!0||f.buffer.detached===void 0&&f.buffer!==n.memory.buffer)&&(f=new DataView(n.memory.buffer)),f}function I(e){return c[e]}function W(e){e<132||(c[e]=l,l=e)}function p(e){const t=I(e);return W(e),t}let h=0;function R(e,t){const r=t(e.length*1,1)>>>0;return y().set(e,r/1),h=e.length,r}const m=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>n.__wbg_model_free(e>>>0,1));class D{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,m.unregister(this),t}free(){const t=this.__destroy_into_raw();n.__wbg_model_free(t,0)}constructor(){try{const o=n.__wbindgen_add_to_stack_pointer(-16);n.model_new(o);var t=u().getInt32(o+4*0,!0),r=u().getInt32(o+4*1,!0),i=u().getInt32(o+4*2,!0);if(i)throw p(r);return this.__wbg_ptr=t>>>0,m.register(this,this.__wbg_ptr,this),this}finally{n.__wbindgen_add_to_stack_pointer(16)}}run(t,r,i){let o,d;try{const _=n.__wbindgen_add_to_stack_pointer(-16),U=R(t,n.__wbindgen_malloc),F=h;n.model_run(_,this.__wbg_ptr,U,F,r,i);var j=u().getInt32(_+4*0,!0),E=u().getInt32(_+4*1,!0),L=u().getInt32(_+4*2,!0),x=u().getInt32(_+4*3,!0),w=j,b=E;if(x)throw w=0,b=0,p(L);return o=w,d=b,g(w,b)}finally{n.__wbindgen_add_to_stack_pointer(16),n.__wbindgen_free(o,d,1)}}}async function T(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}else{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}function k(){const e={};return e.wbg={},e.wbg.__wbindgen_error_new=function(t,r){const i=new Error(g(t,r));return M(i)},e.wbg.__wbg_log_b620f3a9d675ee1a=function(t,r){console.log(g(t,r))},e.wbg.__wbindgen_throw=function(t,r){throw new Error(g(t,r))},e}function z(e,t){return n=e.exports,O.__wbindgen_wasm_module=t,f=null,a=null,n.__wbindgen_start(),n}async function O(e){if(n!==void 0)return n;typeof e<"u"&&Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead"),typeof e>"u"&&(e=new URL("/assets/m_bg-ChOOz-gw.wasm",self.location.href));const t=k();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:i}=await T(await e,t);return z(r,i)}class v{static async getInstance(){return this.instance||(await O(),console.log("Wasm module initialized in worker"),this.instance=new D,console.log("YOLO model initialized in worker")),this.instance}}A(v,"instance",null),self.addEventListener("message",async e=>{const{imageData:t,confidence:r,iouThreshold:i}=e.data;try{self.postMessage({status:"running inference"});const d=await(await v.getInstance()).run(t,r,i);self.postMessage({status:"complete",output:d})}catch(o){self.postMessage({error:o.message})}})})();
